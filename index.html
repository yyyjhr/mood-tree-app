<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æƒ…ç»ªå°æ ‘è‹—</title>
    <style>
        body {
            font-family: 'å¾®è½¯é›…é»‘', sans-serif;
            background-color: #F0F8F0;
            text-align: center;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 500px;
            margin: auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2E8B57;
            font-size: 18px;
            margin-bottom: 10px;
        }
        #tree-image {
            width: 120px;
            height: auto;
            margin-bottom: 15px;
            border-radius: 5px;
        }
        #status-display {
            background-color: #E6F3FF;
            color: #4682B4;
            padding: 10px;
            margin-bottom: 15px;
            border-radius: 5px;
            font-size: 12px;
            text-align: left;
            white-space: pre-line;
        }
        #chat-display {
            height: 250px;
            overflow-y: scroll;
            border: 1px solid #ccc;
            padding: 10px;
            margin-bottom: 15px;
            text-align: left;
            background-color: #f9f9f9;
            border-radius: 5px;
        }
        .user-msg {
            text-align: right;
            color: #0056b3;
            margin-bottom: 8px;
            font-size: 11px;
        }
        .ai-msg {
            text-align: left;
            color: #228B22;
            margin-bottom: 8px;
            font-size: 11px;
            font-style: italic;
        }
        #input-form {
            display: flex;
        }
        #user-input {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px 0 0 5px;
            font-size: 11px;
        }
        button {
            padding: 10px 15px;
            border: none;
            background-color: #90EE90;
            color: white;
            cursor: pointer;
            border-radius: 0 5px 5px 0;
            font-weight: bold;
        }
        button:hover {
            background-color: #7FDD7F;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>å’Œä½ çš„å°æ ‘è‹—è¯´è¯´è¯å§</h1>
        <img id="tree-image" src="seed.png" alt="å°æ ‘è‹—">
        <div id="status-display"></div>
        <div id="chat-display"></div>
        <form id="input-form">
            <input type="text" id="user-input" placeholder="å’Œæˆ‘è¯´ç‚¹ä»€ä¹ˆå§...">
            <button type="submit">å‘é€</button>
        </form>
    </div>

    <script>
        // TreeAgentæ ¸å¿ƒé€»è¾‘
        class TreeAgent {
            constructor() {
                this.health = 50;
                this.happiness = 50;
                this.water = 50;
                this.emotion_keywords = {
                    'positive': ['å¼€å¿ƒ', 'å¿«ä¹', 'é«˜å…´', 'å“ˆå“ˆ', 'çˆ±', 'å–œæ¬¢', 'æ£’', 'ä¸é”™', 'å®Œç¾', 'é¡ºåˆ©'],
                    'negative': ['éš¾è¿‡', 'ä¼¤å¿ƒ', 'å¤±è½', 'éƒé—·', 'çƒ¦', 'è®¨åŒ', 'ç³Ÿç³•', 'å¤±è´¥', 'å“­', 'ç´¯'],
                    'neutral':  ['è¿˜è¡Œ', 'ä¸€èˆ¬', 'æ™®é€š', 'å“¦', 'å—¯', 'çŸ¥é“äº†']
                };
                this.responses = {
                    'positive': ["å¬åˆ°ä½ è¿™ä¹ˆè¯´æˆ‘çœŸå¼€å¿ƒï¼æ„Ÿè§‰æˆ‘åˆé•¿é«˜äº†ä¸€ç‚¹å‘¢ï¼ğŸŒ±", "å¤ªæ£’å•¦ï¼ä½ çš„å¿«ä¹å°±æ˜¯æˆ‘çš„é˜³å…‰ï¼â˜€ï¸", "ä¸ºä½ æ„Ÿåˆ°é«˜å…´ï¼æˆ‘ä»¬ä¸€èµ·åŠ æ²¹ï¼"],
                    'negative': ["æŠ±æŠ±ä½ ï¼Œæ²¡å…³ç³»çš„ï¼Œä¸€åˆ‡éƒ½ä¼šå¥½èµ·æ¥çš„ã€‚ğŸŒ§ï¸", "æˆ‘åœ¨è¿™é‡Œé™ªç€ä½ ï¼ŒæŠŠä¸å¼€å¿ƒéƒ½å‘Šè¯‰æˆ‘å§ã€‚", "åˆ«éš¾è¿‡ï¼Œä½ å·²ç»åšå¾—å¾ˆæ£’äº†ã€‚ä¼‘æ¯ä¸€ä¸‹ï¼Œæ˜å¤©åˆæ˜¯æ–°çš„ä¸€å¤©ã€‚"],
                    'neutral': ["å—¯å—¯ï¼Œæˆ‘å¬ç€å‘¢ã€‚", "åŸæ¥æ˜¯è¿™æ ·å‘€ã€‚", "è°¢è°¢ä½ å‘Šè¯‰æˆ‘è¿™äº›ã€‚"],
                    'thirsty': ["æˆ‘æœ‰ç‚¹æ¸´äº†...ä½ èƒ½å¤šé™ªæˆ‘è¯´è¯´è¯å—ï¼Ÿè¿™å°±åƒç»™æˆ‘æµ‡æ°´ä¸€æ ·ã€‚ğŸ’§", "æ„Ÿè§‰å¶å­æœ‰ç‚¹è”«...éœ€è¦ä½ çš„å…³å¿ƒæ¥è¡¥å……æ°´åˆ†ã€‚"]
                };
            }

            analyze_emotion(text) {
                for (const emotion in this.emotion_keywords) {
                    for (const keyword of this.emotion_keywords[emotion]) {
                        if (text.includes(keyword)) {
                            return emotion;
                        }
                    }
                }
                return 'neutral';
            }

            // ä¿®æ”¹åçš„çŠ¶æ€æ›´æ–°é€»è¾‘
            update_state(emotion) {
                // æ¯å‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œæ°´åˆ†å€¼å’Œå¥åº·å€¼éƒ½æé«˜
                this.water = Math.min(100, this.water + 5);
                this.health = Math.min(100, this.health + 3);
                
                // æ ¹æ®æƒ…ç»ªç±»å‹è°ƒæ•´å¿«ä¹å€¼å’Œå¥åº·å€¼
                if (emotion === 'positive') {
                    this.happiness = Math.min(100, this.happiness + 10);
                    this.health = Math.min(100, this.health + 5); // ç§¯ææ¶ˆæ¯é¢å¤–å¢åŠ å¥åº·å€¼
                } else if (emotion === 'negative') {
                    this.happiness = Math.max(0, this.happiness - 8);
                    this.health = Math.max(0, this.health - 3); // æ¶ˆææ¶ˆæ¯å‡å°‘å¥åº·å€¼
                } else {
                    this.happiness = Math.min(100, this.happiness + 2); // ä¸­æ€§æ¶ˆæ¯ç•¥å¾®å¢åŠ å¿«ä¹å€¼
                }
            }

            get_response(emotion) {
                if (this.water < 30 && Math.random() > 0.5) {
                    const thirstyResponses = this.responses['thirsty'];
                    return thirstyResponses[Math.floor(Math.random() * thirstyResponses.length)];
                }
                const emotionResponses = this.responses[emotion] || this.responses['neutral'];
                return emotionResponses[Math.floor(Math.random() * emotionResponses.length)];
            }

            get_status_text() {
                let status = `ã€å°æ ‘è‹—çŠ¶æ€ã€‘\nå¿«ä¹å€¼: ${this.happiness}/100 ğŸ˜Š\nå¥åº·åº¦:${this.health}/100 â¤ï¸\næ°´åˆ†å€¼: ${this.water}/100 ğŸ’§\n`;
                const avg_status = (this.happiness + this.health + this.water) / 3;
                if (avg_status > 70) status += "\næˆ‘é•¿åŠ¿å–œäººï¼Œæ„Ÿè§‰å¿«è¦å¼€èŠ±äº†ï¼ğŸŒ¸";
                else if (avg_status > 40) status += "\næˆ‘è¿˜åœ¨åŠªåŠ›æˆé•¿ä¸­...ğŸŒ¿";
                else status += "\næˆ‘éœ€è¦ä½ çš„å…³å¿ƒ...å¿«æ¯èäº†...ğŸ¥€";
                return status;
            }
        }

        // åˆå§‹åŒ–
        const form = document.getElementById('input-form');
        const input = document.getElementById('user-input');
        const chatDisplay = document.getElementById('chat-display');
        const treeImage = document.getElementById('tree-image');
        const statusDisplay = document.getElementById('status-display');
        
        const agent = new TreeAgent();

        function updateTreeImage(health) {
            let imageName = 'seed.png';
            if (health >= 85) imageName = 'flowering.png';
            else if (health >= 60) imageName = 'healthy.png';
            else if (health >= 40) imageName = 'young.png';
            else if (health >= 20) imageName = 'sprout.png';
            
            treeImage.src = imageName;
        }

        function updateStatus() {
            statusDisplay.textContent = agent.get_status_text();
        }

        // åˆå§‹åŒ–æ˜¾ç¤º
        window.onload = () => {
            updateStatus();
            updateTreeImage(agent.health);
        };

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const message = input.value.trim();
            if (!message) return;

            // æ˜¾ç¤ºç”¨æˆ·æ¶ˆæ¯
            chatDisplay.innerHTML += `<div class="user-msg">ä½ : ${message}</div>`;
            input.value = '';

            // å¤„ç†æƒ…æ„Ÿå’Œå“åº”
            const emotion = agent.analyze_emotion(message);
            agent.update_state(emotion);
            const response = agent.get_response(emotion);
            
            // æ˜¾ç¤ºAIå“åº”
            chatDisplay.innerHTML += `<div class="ai-msg">å°æ ‘è‹—: ${response}</div>`;
            chatDisplay.scrollTop = chatDisplay.scrollHeight;
            
            // æ›´æ–°çŠ¶æ€å’Œå›¾ç‰‡
            updateStatus();
            updateTreeImage(agent.health);
        });
    </script>
</body>
</html>